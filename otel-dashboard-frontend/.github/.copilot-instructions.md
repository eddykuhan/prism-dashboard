# Copilot Instructions - Angular Dashboard Frontend

Guide for using the AI-powered Copilot debugging features integrated into the OTEL Dashboard Frontend.

## üìã Table of Contents
- [Quick Start](#-quick-start)
- [When Copilot is Enabled](#-when-copilot-is-enabled)
- [Features](#-features)
- [How to Use](#-how-to-use)
- [Chat Interface](#-chat-interface)
- [Context Sharing](#-context-sharing)
- [Troubleshooting](#-troubleshooting)
- [Configuration](#-configuration)
- [Tips & Best Practices](#-tips--best-practices)

## üöÄ Quick Start

1. **Sign In to Azure AD**
   ```
   Click "Sign In" button (top right)
   ‚Üí Authenticate with your Microsoft account
   ‚Üí Grant consent for Azure OpenAI access
   ```

2. **Look for Copilot Buttons**
   - In **Traces tab**: "Analyze Trace with Copilot" button on each trace
   - In **Logs tab**: "Explain with Copilot" button next to log entries
   - In **Spans**: "Explain" button on individual spans

3. **Start a Chat**
   - Click any Copilot button
   - AI panel opens with context pre-filled
   - Ask questions or let AI suggest next steps

4. **Chat Normally**
   - Type your question
   - Press Enter or click Send
   - View responses in real-time

## ü§ñ When Copilot is Enabled

Copilot is available when:
- ‚úÖ `authEnabled: true` in `/api/v1/config`
- ‚úÖ `copilotEnabled: true` in `/api/v1/config`
- ‚úÖ User is signed in to Azure AD
- ‚úÖ User has access to Azure OpenAI resource

Copilot is disabled (buttons hidden) when:
- ‚ùå Auth is disabled in config
- ‚ùå Copilot feature flag is off
- ‚ùå User not authenticated
- ‚ùå Azure OpenAI is unavailable

## ‚ú® Features

### 1. Trace Analysis
**Where**: Traces tab ‚Üí "Analyze Trace with Copilot" button

**What it does**:
- Explains what the trace shows
- Identifies bottlenecks and slow spans
- Detects errors and anomalies
- Suggests performance improvements
- Recommends debugging steps

**Example questions**:
- "Why is this trace slow?"
- "What's causing the timeout?"
- "Is this error expected?"
- "How can I optimize this path?"

### 2. Log Explanation
**Where**: Logs tab ‚Üí "Explain with Copilot" button

**What it does**:
- Translates technical log messages
- Explains error codes and stack traces
- Provides remediation steps
- Suggests related logs to check
- Identifies patterns in error logs

**Example questions**:
- "What does this error mean?"
- "How do I fix this issue?"
- "Are there similar errors?"
- "Should I be concerned about this?"

### 3. Span Analysis
**Where**: Traces ‚Üí Individual span ‚Üí "Explain" button

**What it does**:
- Breaks down what a span represents
- Explains span attributes and tags
- Identifies span anomalies
- Suggests related spans to inspect
- Provides operation context

**Example questions**:
- "What is this span doing?"
- "Why did this span fail?"
- "Is this span duration normal?"
- "What operation triggered this?"

### 4. Multi-turn Conversation
**Where**: Chat panel (open after clicking any Copilot button)

**Features**:
- Ask follow-up questions
- Build on previous context
- Explore multiple debugging angles
- Get detailed explanations
- Receive actionable recommendations

**Example conversation flow**:
1. Click "Analyze Trace" on slow trace
2. Ask: "Why is it slow?"
3. Follow-up: "What's the database query doing?"
4. Next: "How can I optimize it?"
5. Finally: "Show me similar patterns in other traces"

## üéØ How to Use

### Analyzing a Failed Trace

1. **Navigate to Traces tab**
2. **Find a trace with errors** (usually marked in red)
3. **Click "Analyze Trace with Copilot"**
   - Error context auto-loads
   - Chat panel opens
4. **Ask about the error**
   ```
   "Why did this request fail?"
   "What does this timeout mean?"
   "Is this a known issue?"
   ```
5. **Get remediation advice**
   - AI explains the root cause
   - Suggests fixes
   - Recommends next steps

### Explaining a Confusing Log Entry

1. **Go to Logs tab**
2. **Find a log message you don't understand**
3. **Click "Explain with Copilot"**
   - Log context loads
   - Chat opens with log message included
4. **Ask for clarity**
   ```
   "What does this error code mean?"
   "How do I fix this?"
   "Is this a warning or error?"
   ```
5. **Get detailed explanation**
   - Meaning of error/warning
   - Common causes
   - Resolution steps

### Deep-Diving into a Span

1. **In Traces tab, expand a trace**
2. **Click on any span**
3. **Click "Explain" button on the span**
   - Span details pre-load
   - Chat opens with span context
4. **Ask about the operation**
   ```
   "What is this database call doing?"
   "Why is this span taking 500ms?"
   "What system is this calling?"
   ```
5. **Understand the operation**
   - Gets detailed breakdown
   - Sees performance metrics
   - Identifies optimization opportunities

## üí¨ Chat Interface

### Message Format

**You send**:
- Plain text questions
- Follow-up clarifications
- Specific technical queries

**AI responds with**:
- Clear explanations
- Code snippets (when relevant)
- Step-by-step guidance
- Performance recommendations

### Navigation in Chat

- **Scroll up** - View previous messages in conversation
- **Scroll down** - View latest response
- **Send button** - Submit your message
- **Close button** - Minimize chat (context preserved)

### Chat Features

- ‚úÖ Real-time streaming responses (you see text as it's generated)
- ‚úÖ Full message history in current session
- ‚úÖ Multiple conversations (each starts fresh when you click new button)
- ‚úÖ Copy responses (select and copy to clipboard)

## üîó Context Sharing

### Automatic Context

When you use Copilot, the following context is automatically sent:

**From Trace Analysis**:
- Trace ID
- Span IDs and names
- Timing data
- Error messages
- Service names
- Operation attributes

**From Log Explanation**:
- Full log message
- Log level (ERROR, WARN, INFO, DEBUG)
- Timestamp
- Logger name
- Stack trace (if present)

**From Span Analysis**:
- Span name
- Operation name
- Duration
- Status (success/error)
- Attributes and tags
- Parent/child relationships

### What's NOT Shared

- üîí User credentials or tokens
- üîí Full request/response bodies
- üîí Personally identifiable information (PII)
- üîí Database connection strings
- üîí API keys

**Privacy Note**: Context is sent to Azure OpenAI. Review your organization's data governance policies before using with sensitive information.

## üêõ Troubleshooting

### Copilot Button Not Showing

**Symptom**: No "Analyze Trace with Copilot" buttons visible

**Solutions**:
1. **Check if signed in**
   - Look for user avatar in top right
   - If not signed in, click "Sign In"

2. **Verify config**
   ```bash
   # In browser console:
   fetch('/api/v1/config').then(r => r.json()).then(console.log)
   # Check: authEnabled: true AND copilotEnabled: true
   ```

3. **Check network connectivity**
   - Verify no network errors in browser console
   - Test API endpoint manually

4. **Clear browser cache**
   ```javascript
   // In browser console:
   localStorage.clear()
   // Refresh page
   ```

### Chat Not Responding

**Symptom**: Click Copilot button, chat opens but shows loading forever

**Solutions**:
1. **Check auth status**
   ```bash
   # Check if token still valid
   # Try signing out and back in
   ```

2. **Network debugging**
   - Open DevTools ‚Üí Network tab
   - Look for `/api/v1/ai/chat` request
   - Check response status (should be 200)
   - Check for error message in response

3. **API availability**
   - Verify backend running: `curl http://localhost:5003/api/v1/health`
   - Check Azure OpenAI service status

4. **Clear cache**
   - `localStorage.clear()`
   - Hard refresh (Cmd+Shift+R on Mac, Ctrl+Shift+R on Windows)

### "Access Denied" Error

**Symptom**: Chat responds with "403 Forbidden" or similar

**Causes & Solutions**:
1. **User lacks permissions**
   - Azure AD app role assignment issue
   - Ask admin to grant "Copilot User" role
   - Contact: [Your IT Admin]

2. **Token expired**
   - Sign out and back in
   - MSAL will refresh tokens automatically

3. **Azure OpenAI unavailable**
   - Check service status page
   - Verify credentials in backend config
   - Try again in a few minutes

### Slow Response Times

**Symptom**: Chat takes 30+ seconds to respond

**Possible reasons**:
- Azure OpenAI API latency
- Network connectivity issues
- Large context (very long traces)

**Solutions**:
- Wait for response (streaming may appear slow initially)
- Try simpler questions with less context
- Refresh and try again

### Chat loses context when minimized

**Symptom**: Close chat panel, reopen, history is gone

**This is expected**: Each chat session is separate. When you close the panel:
- Your conversation history is preserved in the backend
- Opening a new chat (clicking button again) starts a fresh conversation
- This is by design to prevent token consumption

**Workaround**: Keep chat open while exploring related traces

## ‚öôÔ∏è Configuration

### Backend Configuration (Admin Only)

**Location**: `appsettings.json` or environment variables

```json
{
  "Auth": {
    "Enabled": true  // Enable/disable auth
  },
  "Copilot": {
    "Enabled": true,  // Enable/disable AI features
    "MaxTokens": 2000  // Max response length
  }
}
```

### Runtime Toggles

Config is loaded from `/api/v1/config` on app startup.

**To verify current settings**:
```javascript
// In browser console:
const config = await fetch('/api/v1/config').then(r => r.json());
console.log(config.authEnabled, config.copilotEnabled);
```

### Changing Settings (Requires Backend Restart)

1. **Update backend configuration**
   ```bash
   cd dotnet-api
   # Edit appsettings.json or set environment variables
   COPILOT_ENABLED=false  # Disable Copilot
   AUTH_ENABLED=false     # Disable Auth
   ```

2. **Restart backend**
   ```bash
   # Stop running service
   # Start with new config
   ```

3. **Frontend auto-updates**
   - Page refresh loads new config
   - Copilot buttons appear/disappear

## üí° Tips & Best Practices

### Getting Better Responses

1. **Be Specific**
   - ‚ùå "This is slow"
   - ‚úÖ "This database query took 2.5 seconds, why?"

2. **Ask Follow-ups**
   - ‚ùå One question, then close
   - ‚úÖ Build on AI's response with more questions

3. **Provide Context**
   - ‚ùå "Fix this error"
   - ‚úÖ "This Java service is getting ClassNotFoundException for com.example.Handler"

4. **Use Technical Terms**
   - AI understands: latency, throughput, timeout, deadlock, race condition, etc.
   - Be precise about error types and service names

5. **Ask Why, Not Just What**
   - ‚ùå "What is this error?"
   - ‚úÖ "Why would a timeout happen in the database connection pool?"

### Debugging Workflow

1. **Find the anomaly** (slow trace, error log, failed span)
2. **Ask Copilot to explain** (get first hypothesis)
3. **Ask follow-up questions** (narrow down root cause)
4. **Get recommendations** (how to fix)
5. **Take action** (implement fix, redeploy)
6. **Verify solution** (run trace again, compare)

### Cost Optimization

- **Keep conversations focused** - Multiple short questions cost less than one vague one
- **Copy useful responses** - Save to your wiki/docs instead of re-asking
- **Use for first-pass debugging** - Don't ask trivial questions; try searching logs first
- **Monitor token usage** - AI responses use tokens (costs money)

### Privacy & Security

- ‚ùå Never ask Copilot to explain PII (email, SSN, password, API key)
- ‚ùå Never share production database connection details
- ‚ùå Be cautious with customer data
- ‚úÖ Redact sensitive info before asking about logs
- ‚úÖ Review what context is being sent before clicking button

## üìö Examples

### Example 1: Debugging a Timeout

```
User: Click "Analyze Trace" on timeout trace
    ‚Üì
Copilot: "This trace shows a 30-second timeout in your payment service. 
The database query to get_user_profile took 28 seconds. This looks like 
a database performance issue, not your code."
    ‚Üì
User: "Why would get_user_profile be so slow?"
    ‚Üì
Copilot: "Possible causes: 1) Full table scan on user table, 2) Slow 
network to database, 3) Database CPU at capacity. Check your database 
query execution plan and ensure user_id index exists."
    ‚Üì
User: "How do I check the execution plan?"
    ‚Üì
Copilot: [Provides database query syntax and analysis steps]
```

### Example 2: Understanding an Error

```
User: Click "Explain with Copilot" on error log
    ‚Üì
Copilot: "OutOfMemoryException: Java heap space. Your application ran 
out of memory. This typically means a memory leak or insufficient 
heap allocation."
    ‚Üì
User: "What causes memory leaks in this context?"
    ‚Üì
Copilot: "Common causes: 1) Unclosed file handles, 2) Circular 
references preventing garbage collection, 3) Unbounded caches. 
Your logs show repeated '[Service]' initialization."
    ‚Üì
User: "How do I fix the Service initialization issue?"
    ‚Üì
Copilot: [Provides specific code recommendations]
```

### Example 3: Exploring a Span

```
User: Click "Explain" on a span named "db.query.execute"
    ‚Üì
Copilot: "This span represents a database query execution. It took 
145ms and succeeded. The query is 'SELECT * FROM orders WHERE user_id=?'."
    ‚Üì
User: "Is 145ms normal for this query?"
    ‚Üì
Copilot: "For this query, 145ms is slow. Typical execution should be 
10-50ms. You likely need an index on the user_id column."
    ‚Üì
User: "Show me how to add that index"
    ‚Üì
Copilot: [Provides SQL syntax and migration steps]
```

## üéì Learning Resources

- See [Frontend README.md](./README.md) for architecture overview
- See [../.copilot-instructions.md](../.copilot-instructions.md) for general usage
- Check DevTools Network tab to see actual API calls
- Review OpenTelemetry concepts: https://opentelemetry.io/docs/

## ‚ùì FAQs

**Q: Does Copilot have access to my database?**
A: No. Copilot only sees data that's visible in the dashboard (traces, logs, metrics).

**Q: Can I share my chat with colleagues?**
A: Not directly. Save the trace/log ID and share the link. Colleague can open and run Copilot themselves.

**Q: Is my data stored?**
A: Conversations are sent to Azure OpenAI for processing. Check your organization's data retention policies.

**Q: Can Copilot make code changes?**
A: No. Copilot explains issues and recommends fixes, but doesn't write/deploy code.

**Q: What if Copilot's answer is wrong?**
A: It's a tool, not gospel. Always verify recommendations before deploying. Ask follow-up questions if something seems off.

---

**Need help?** Contact: [Your Support Channel] or check dashboard status at http://localhost:5003
